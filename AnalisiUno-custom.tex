\newif\ifwidemargin

\newcommand{\eps}{\varepsilon}
\renewcommand{\phi}{\varphi}
\newcommand{\loc}{\mathit{loc}}
\newcommand{\weakto}{\rightharpoonup}
\newcommand{\implied}{\Longleftarrow}
\let\subsetstrict\subset
\renewcommand{\subset}{\subseteq}
\renewcommand{\supset}{\supseteq}

% calligraphic letters
\newcommand{\A}{\mathcal A}
\newcommand{\B}{\mathcal B}
\def\C{dummy C command} % necessario perche' non sempre \C risulta gia' definito
\renewcommand{\C}{\mathcal C}
\newcommand{\D}{\mathcal D}
\newcommand{\E}{\mathcal E}
\newcommand{\F}{\mathcal F}
\newcommand{\FL}{\mathcal F\!\mathcal L}
\renewcommand{\H}{\mathcal H}
\newcommand{\K}{\mathcal K}
\renewcommand{\L}{\mathcal L}
\newcommand{\M}{\mathcal M}
\renewcommand{\P}{\mathcal P}
\renewcommand{\S}{\mathcal S}
\def\U{dummy U command} % necessario perche' non sempre \U risulta gia' definito
\renewcommand{\U}{\mathcal U} %% intorni

% blackboard letters
\newcommand{\CC}{{\mathbb C}}
\newcommand{\HH}{{\mathbb H}}
\newcommand{\KK}{{\mathbb K}}
\newcommand{\NN}{{\mathbb N}}
\newcommand{\QQ}{{\mathbb Q}}
\newcommand{\RR}{{\mathbb R}}
\newcommand{\TT}{{\mathbb T}}
\newcommand{\ZZ}{{\mathbb Z}}

\newcommand{\abs}[1]{{\left|#1\right|}}
\newcommand{\Abs}[1]{{\left\Vert #1\right\Vert}}
\newcommand{\enclose}[1]{{\left( #1 \right)}}
\newcommand{\Enclose}[1]{{\left[ #1 \right]}}
\newcommand{\ENCLOSE}[1]{{\left\{ #1 \right\}}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\openinterval}[2]{\left(#1,#2\right)}
\newcommand{\closeinterval}[2]{\left[#1,#2\right]}
\newcommand{\closeopeninterval}[2]{\left[#1,#2\right)}
\newcommand{\opencloseinterval}[2]{\left(#1,#2\right]}

\newcommand{\To}{\rightrightarrows}
\renewcommand{\vec}[1]{\boldsymbol #1}
\newcommand{\defeq}{=}
\DeclareMathOperator{\divergence}{div}
\renewcommand{\div}{\divergence}
% \DeclareMathOperator{\ker}{ker}  %% already defined
\DeclareMathOperator{\Imaginarypart}{Im}
\renewcommand{\Im}{\Imaginarypart}
\DeclareMathOperator{\Realpart}{Re}
\renewcommand{\Re}{\Realpart}
\newcommand{\id}{\mathrm{id}} %% identit√†
%\DeclareMathOperator{\arg}{arg}
\DeclareMathOperator{\tg}{tg}
\DeclareMathOperator{\arctg}{arctg}
\DeclareMathOperator{\tgh}{tgh}
\DeclareMathOperator{\settsinh}{settsinh}
\DeclareMathOperator{\settcosh}{settcosh}
\DeclareMathOperator{\setttgh}{setttgh}
\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\li}{li}
\DeclareMathOperator{\ei}{ei}
\DeclareMathOperator{\Si}{Si}
\DeclareMathOperator{\FresnelS}{S}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\osc}{osc}

%% thmtools configuration

\declaretheoremstyle[
spaceabove=6pt, spacebelow=6pt,
headfont=\normalfont\bfseries\itshape,
notefont=\mdseries, notebraces={(}{)},
bodyfont=\normalfont,
postheadspace=1em,
qed=,
%shaded={rulecolor=pink!30,rulewidth=1pt,bgcolor=pink!10}
]{exercise_style}

\declaretheoremstyle[
spaceabove=6pt, spacebelow=6pt,
postheadspace=1em,
qed=,
%shaded={rulecolor=blue!20,rulewidth=1pt,bgcolor=blue!5}
]{theorem_style}

\declaretheoremstyle[
spaceabove=6pt, spacebelow=6pt,
postheadspace=1em,
qed=,
%shaded={rulecolor=yellow!50,rulewidth=1pt,bgcolor=yellow!5}
]{axiom_style}

\numberwithin{equation}{chapter}
\declaretheorem[name=Teorema,numberwithin=chapter]{theorem}
\declaretheorem[name=Lemma,sibling=theorem]{lemma}
\declaretheorem[name=Proposizione,sibling=theorem]{proposition}
\declaretheorem[name=Corollario,sibling=theorem]{corollary}
\declaretheorem[name=Paradosso,sibling=theorem]{paradox}
\declaretheorem[%style=axiom_style,
name=Assioma,sibling=theorem]{axiom}
\declaretheorem[name=Definizione,sibling=theorem]{definition}
\declaretheorem[%style=exercise_style,
name=Esempio,sibling=theorem]{example}
\declaretheorem[%style=exercise_style,
name=Esercizio,sibling=theorem]{exercise}
\declaretheorem[%style=exercise_style,
name=Osservazione,sibling=theorem]{remark}


%\newtheorem{theorem}{Teorema}[chapter]
%\newtheorem{lemma}[theorem]{Lemma}
%\newtheorem{exercise}[theorem]{Esercizio}
%\newtheorem{proposition}[theorem]{Proposizione}
%\newtheorem{corollary}[theorem]{Corollario}
%\newtheorem{example}[theorem]{Esempio}
%\newtheorem{definition}[theorem]{Definizione}
%\newtheorem{axiom}[theorem]{Assioma}

%% average integral, see https://tex.stackexchange.com/questions/759/average-integral-symbol
\def\Xint#1{\mathchoice
{\XXint\displaystyle\textstyle{#1}}%
{\XXint\textstyle\scriptstyle{#1}}%
{\XXint\scriptstyle\scriptscriptstyle{#1}}%
{\XXint\scriptscriptstyle\scriptscriptstyle{#1}}%
\!\int}
\def\XXint#1#2#3{{\setbox0=\hbox{$#1{#2#3}{\int}$ }
\vcenter{\hbox{$#2#3$ }}\kern-.6\wd0}}
\def\ddashint{\Xint=}
\def\dashint{\Xint-}

\ExplSyntaxOn
\newcommand\stripExclamation[1]{
\def\tmp{#1}
\regex_replace_all:nnN { "! } { 91848243 }\tmp
\regex_replace_all:nnN { ! } { \  }\tmp
\regex_replace_all:nnN { 91848243 } { ! }\tmp
\tmp}
\ExplSyntaxOff

% % danger symbol
% \newcommand*{\TakeFourierOrnament}[1]{{%
% \fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
% \newcommand*{\danger}{\TakeFourierOrnament{66}}

% \newcommand{\mymark}[1]{\reversemarginpar\marginnote{#1}\normalmarginpar}
% \newcommand{\mymark}[1]{\marginnote{#1}}
%% disable mymark. Non riesco a farlo funzionare correttamente ...
\newcommand{\mymark}[1]{}

\newcommand{\mymargin}[1]{%
\marginnote{\tcbox[colback=white,boxrule=0.5pt,arc=1pt,boxsep=3pt,left=0pt,right=0pt,top=1pt,bottom=0pt]{%
{\footnotesize#1}}}}

\newcommand{\mynote}[1]{\marginnote{#1}}

\newwrite\myauxfile
\immediate\openout\myauxfile=AnalisiUno.myaux
\newcommand{\myaux}[1]{\write\myauxfile{#1}}

% aggiungi un link nella pagina HTML della documentazione
% #1: url completo
% #2: descrizione HTML
\newcommand{\mydoclink}[2]{%
\myaux{<!--MYDOCLINK--><li><a href="#1">#2</a> (pagina \thepage, capitolo \thechapter)</li>}% 
}

% url completo da abbreviazione
% #1 shorten url della pagina: l'url completo va messo in make-docs.sh
\newcommand{\myshorturl}[1]{http://paolini.github.io/AnalisiUno?#1}

% crea qr code
% #1: url completo della pagina
% #2: testo da scrivere sotto il qrcode
\newcommand{\myqr}[2]{%
  \begin{minipage}{1.5cm}\qrcode[height=1.3cm]{#1}\\%
    \scriptsize{#2}%
  \end{minipage}%   
}

%% negli URL i caratteri % vanno sostituiti con \%

% #1: url della pagina
% #2: testo da scrivere sotto il qrcode
% #3: testo HTML da scrivere nel link della documentazione
\newcommand{\myqrdoclink}[3]{%
\mydoclink{#1}{#3}\myqr{#1}{#2}%
}

% mette un QR code nel margine
% #1: url della pagina
% #2: testo da scrivere sotto il qr code
% #3: testo HTML da scrivere nel link della documentazione
\newcommand{\myqrcode}[3]{%
  \marginnote{\myqrdoclink{#1}{#2}{#3}}%
}

% mette un QR code nel margine, con shorturl
% #1: codice short dell'url
% #2: testo da scrivere sotto il qr code
% #3: testo HTML da scrivere nel link della documentazione
\newcommand{\myshortqrcode}[3]{%
  \marginnote{\mydoclink{?#1}{#3}\myqr{\myshorturl{#1}}{#2}}%
}

% #1 shorten url della pagina: l'url completo va messo in make-docs.sh
% #2 testo HTML da scrivere nel link della documentazione
\newcommand{\myurl}[2]{%
\marginnote{\myqrdoclink{\myshorturl{#1}}{(interagisci)}{#2}}%
}

% come \myurl ma con un offset verticale #3
\newcommand{\myurloff}[3]{%
\marginnote{\myqrdoclink{\myshorturl{#1}}{(interagisci)}{#2}}[#3]%
}

% come \myurl ma non va nel margine
\newcommand{\myurlhere}[2]{%
\mydoclink{?#1}{#2}\myqr{\myshorturl{#1}}{(interagisci)}%
}

% #1: short url della pagina
% #2: testo HTML da scrivere nel link della documentazione
\newcommand{\myqrshortdoclink}[2]{%
\mydoclink{?#1}{#2}\myqr{\myshorturl{#1}}{(interagisci)}%
}