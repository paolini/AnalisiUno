\newcommand{\eps}{\varepsilon}
\renewcommand{\phi}{\varphi}
\newcommand{\loc}{\mathit{loc}}
\newcommand{\weakto}{\rightharpoonup}
\newcommand{\implied}{\Longleftarrow}
\let\subsetstrict\subset
\renewcommand{\subset}{\subseteq}
\renewcommand{\supset}{\supseteq}

% calligraphic letters
\newcommand{\A}{\mathcal A}
\newcommand{\B}{\mathcal B}
\renewcommand{\C}{\mathcal C}
\newcommand{\D}{\mathcal D}
\newcommand{\E}{\mathcal E}
\newcommand{\F}{\mathcal F}
\newcommand{\FL}{\mathcal F\!\mathcal L}
\renewcommand{\H}{\mathcal H}
\newcommand{\K}{\mathcal K}
\renewcommand{\L}{\mathcal L}
\newcommand{\M}{\mathcal M}
\renewcommand{\P}{\mathcal P}
\renewcommand{\S}{\mathcal S}
\renewcommand{\U}{\mathcal U} %% intorni

% blackboard letters
\newcommand{\CC}{\mathbb C}
\newcommand{\HH}{\mathbb H}
\newcommand{\KK}{\mathbb K}
\newcommand{\NN}{\mathbb N}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\TT}{\mathbb T}
\newcommand{\ZZ}{\mathbb Z}

\newcommand{\abs}[1]{{\left|#1\right|}}
\newcommand{\Abs}[1]{{\left\Vert #1\right\Vert}}
\newcommand{\enclose}[1]{{\left( #1 \right)}}
\newcommand{\Enclose}[1]{{\left[ #1 \right]}}
\newcommand{\ENCLOSE}[1]{{\left\{ #1 \right\}}}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\openinterval}[2]{\left(#1,#2\right)}
\newcommand{\closeinterval}[2]{\left[#1,#2\right]}
\newcommand{\closeopeninterval}[2]{\left[#1,#2\right)}
\newcommand{\opencloseinterval}[2]{\left(#1,#2\right]}

\newcommand{\To}{\rightrightarrows}
\renewcommand{\vec}[1]{\boldsymbol #1}
\newcommand{\defeq}{:=}
\DeclareMathOperator{\divergence}{div}
\renewcommand{\div}{\divergence}
% \DeclareMathOperator{\ker}{ker}  %% already defined
\DeclareMathOperator{\Imaginarypart}{Im}
\renewcommand{\Im}{\Imaginarypart}
\DeclareMathOperator{\Realpart}{Re}
\renewcommand{\Re}{\Realpart}
%\DeclareMathOperator{\arg}{arg}
\DeclareMathOperator{\tg}{tg}
\DeclareMathOperator{\arctg}{arctg}
\DeclareMathOperator{\tgh}{tgh}
\DeclareMathOperator{\settsinh}{settsinh}
\DeclareMathOperator{\settcosh}{settcosh}
\DeclareMathOperator{\setttgh}{setttgh}
\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\li}{li}
\DeclareMathOperator{\ei}{ei}
\DeclareMathOperator{\Si}{Si}
\DeclareMathOperator{\FresnelS}{S}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\diag}{diag}

\declaretheoremstyle[
spaceabove=6pt, spacebelow=6pt,
headfont=\normalfont\bfseries\itshape,
notefont=\mdseries, notebraces={(}{)},
bodyfont=\normalfont,
postheadspace=1em,
qed=,
%shaded={rulecolor=pink!30,rulewidth=1pt,bgcolor=pink!10}
]{exercise_style}

\declaretheoremstyle[
spaceabove=6pt, spacebelow=6pt,
postheadspace=1em,
qed=,
%shaded={rulecolor=blue!20,rulewidth=1pt,bgcolor=blue!5}
]{theorem_style}

\declaretheoremstyle[
spaceabove=6pt, spacebelow=6pt,
postheadspace=1em,
qed=,
%shaded={rulecolor=yellow!50,rulewidth=1pt,bgcolor=yellow!5}
]{axiom_style}

\numberwithin{equation}{chapter}
%\declaretheorem[name=Teorema,numberwithin=chapter]{theorem}
%\declaretheorem[name=Lemma,sibling=theorem]{lemma}
%\declaretheorem[name=Proposizione,sibling=theorem]{proposition}
%\declaretheorem[name=Corollario,sibling=theorem]{corollary}
%\declaretheorem[name=Paradosso,sibling=theorem]{paradox}
%\declaretheorem[%style=axiom_style,
%name=Assioma,sibling=theorem]{axiom}
%\declaretheorem[%name=Definizione,
%sibling=theorem]{definition}
%\declaretheorem[%style=exercise_style,
%name=Esempio,sibling=theorem]{example}
%\declaretheorem[%style=exercise_style,
%name=Esercizio,sibling=theorem]{exercise}
%\declaretheorem[%style=exercise_style,
%name=Osservazione,sibling=theorem]{remark}


%\newtheorem{theorem}{Teorema}[chapter]
%\newtheorem{lemma}[theorem]{Lemma}
%\newtheorem{exercise}[theorem]{Esercizio}
%\newtheorem{proposition}[theorem]{Proposizione}
%\newtheorem{corollary}[theorem]{Corollario}
%\newtheorem{example}[theorem]{Esempio}
%\newtheorem{definition}[theorem]{Definizione}
%\newtheorem{axiom}[theorem]{Assioma}

%% average integral, see https://tex.stackexchange.com/questions/759/average-integral-symbol
\def\Xint#1{\mathchoice
{\XXint\displaystyle\textstyle{#1}}%
{\XXint\textstyle\scriptstyle{#1}}%
{\XXint\scriptstyle\scriptscriptstyle{#1}}%
{\XXint\scriptscriptstyle\scriptscriptstyle{#1}}%
\!\int}
\def\XXint#1#2#3{{\setbox0=\hbox{$#1{#2#3}{\int}$ }
\vcenter{\hbox{$#2#3$ }}\kern-.6\wd0}}
\def\ddashint{\Xint=}
\def\dashint{\Xint-}

\ExplSyntaxOn
\newcommand\stripExclamation[1]{
\def\tmp{#1}
\regex_replace_all:nnN { "! } { 91848243 }\tmp
\regex_replace_all:nnN { ! } { \  }\tmp
\regex_replace_all:nnN { 91848243 } { ! }\tmp
\tmp}
\ExplSyntaxOff

\newcommand{\mymark}[1]{\reversemarginpar\marginnote{#1}\normalmarginpar}

\newcommand{\mynote}[1]{\marginnote{{\footnotesize\stripExclamation{#1}}}}
\newcommand{\mymargin}[1]{\mynote{#1}\index{#1}}
% utilizzo di myemph:
% \myemph[margin note]{emph and index}
\newcommand{\myemph}[2][dummy_not_defined]{%
  \emph{\stripExclamation{#2}}%
  \ifthenelse{\equal{#1}{dummy_not_defined}}%
    {\ifthenelse{\isempty{#2}}{}{\mynote{#2}}%
    \index{#2}}%
    {\mynote{#1}%
    \index{#2}}}%

\newwrite\myauxfile
\immediate\openout\myauxfile=AnalisiUno.myaux
\newcommand{\myaux}[1]{\write\myauxfile{#1}}

% #1 shorten url della pagina: l'url completo va messo in make-docs.sh
% #2 testo HTML da scrivere nel link della documentazione
\newcommand{\myurl}[2]{%
\marginnote{\qrcode[height=1.3cm]{http://paolini.github.io/AnalisiUno?#1}\\%
\scriptsize{(interagisci)}~}%
\write\myauxfile{<!--MYURL--><li><a href="?#1">#2</a> (pagina \thepage, capitolo \thechapter)</li>}%
}
% come \myurl ma con un offset verticale #3
\newcommand{\myurloff}[3]{%
\marginnote{\qrcode[height=1.3cm]{http://paolini.github.io/AnalisiUno?#1}\\%
\scriptsize{(interagisci)}~}[#3]%
\write\myauxfile{<!--MYURL--><li><a href="?#1">#2</a> (pagina \thepage, capitolo \thechapter)</li>}%
}
%
% #1: url della pagina
% #2: testo da scrivere sotto il qrcode
% #3: testo HTML da scrivere nel link della documentazione
%% negli URL i caratteri % vanno sostituiti con \%
\newcommand{\myqrcode}[3]{%
  \marginnote{\qrcode[height=1.7cm]{#1}\\%
  {\footnotesize #2}}%
  \myaux{<!--MYQRCODE--><li><a href="#1">#2 #3</a> (pagina \thepage)</li>}%
  }
